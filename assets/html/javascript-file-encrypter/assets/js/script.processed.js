$((function(){var t=$("body"),e=$("#stage"),a=$("a.back");$("#step1 .encrypt").click((function(){t.attr("class","encrypt"),r(2)})),$("#step1 .decrypt").click((function(){t.attr("class","decrypt"),r(2)})),$("#step2 .button").click((function(){$(this).parent().find("input").click()}));var n=null;function r(t){1==t?a.fadeOut():a.fadeIn(),e.css("top",100*-(t-1)+"%")}$("#step2").on("change","#encrypt-input",(function(t){if(1!=t.target.files.length)return alert("Please select a file to encrypt!"),!1;(n=t.target.files[0]).size>1048576?alert("Please choose files smaller than 1mb, otherwise you may crash your browser. \nThis is a known issue. See the tutorial."):r(3)})),$("#step2").on("change","#decrypt-input",(function(t){if(1!=t.target.files.length)return alert("Please select a file to decrypt!"),!1;n=t.target.files[0],r(3)})),$("a.button.process").click((function(){var e=$(this).parent().find("input[type=password]"),a=$("#step4 a.download"),s=e.val();if(e.val(""),s.length<5)alert("Please choose a longer password!");else{var c=new FileReader;t.hasClass("encrypt")?(c.onload=function(t){var e=CryptoJS.AES.encrypt(t.target.result,s);a.attr("href","data:application/octet-stream,"+e),a.attr("download",n.name+".encrypted"),r(4)},c.readAsDataURL(n)):(c.onload=function(t){var e=CryptoJS.AES.decrypt(t.target.result,s).toString(CryptoJS.enc.Latin1);if(!/^data:/.test(e))return alert("Invalid pass phrase or file! Please try again."),!1;a.attr("href",e),a.attr("download",n.name.replace(".encrypted","")),r(4)},c.readAsText(n))}})),a.click((function(){$("#step2 input[type=file]").replaceWith((function(){return $(this).clone()})),r(1)}))}));